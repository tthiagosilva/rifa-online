
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Rifa Online</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>Rifa Online</h1>
  <p>Escolha seus números:</p>
  <div id="circle"></div>
  <input type="text" id="nome" placeholder="Seu nome">
  <br>
  <button onclick="confirmar()">Confirmar e Enviar via WhatsApp</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDS8PvI9sIP6wLTHz85C13gRiilyNZD96Q",
      authDomain: "rifadaesperancaonline.firebaseapp.com",
      projectId: "rifadaesperancaonline"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const circle = document.getElementById("circle");
    const total = 150;
    const radius = 250;
    let ocupados = [];
    let selecionados = [];

    function desenharNúmeros() {
      for (let i = 1; i <= total; i++) {
        const ang = (2 * Math.PI / total) * i;
        const x = radius + radius * Math.cos(ang) - 25;
        const y = radius + radius * Math.sin(ang) - 25;
        const div = document.createElement("div");
        div.className = "number";
        div.style.left = x + "px";
        div.style.top = y + "px";
        div.textContent = i;
        div.dataset.numero = i;

        if (ocupados.includes(i)) {
          div.classList.add("occupied");
        } else {
          div.onclick = () => toggleSelecionado(div);
        }

        circle.appendChild(div);
      }
    }

    function toggleSelecionado(div) {
      const numero = parseInt(div.dataset.numero);
      if (div.classList.contains("selected")) {
        div.classList.remove("selected");
        selecionados = selecionados.filter(n => n !== numero);
      } else {
        div.classList.add("selected");
        selecionados.push(numero);
      }
    }

    async function carregarOcupados() {
      const snapshot = await db.collection("rifa").get();
      ocupados = snapshot.docs.map(doc => doc.data().numero);
      desenharNúmeros();
    }

    async function confirmar() {
      const nome = document.getElementById("nome").value.trim();
      if (!nome || selecionados.length === 0) {
        alert("Informe seu nome e selecione pelo menos um número.");
        return;
      }

      for (let numero of selecionados) {
        await db.collection("rifa").add({
          nome,
          numero,
          timestamp: new Date()
        });
      }

      const msg = `Olá! Meu nome é ${nome} e escolhi os números: ${selecionados.join(", ")} na Rifa Online.`;
      const link = `https://wa.me/?text=${encodeURIComponent(msg)}`;
      window.open(link, "_blank");
      location.reload();
    }

    carregarOcupados();
  </script>
</body>
</html>
